services:
  chap:
    depends_on:
      - redis
      - worker
      - postgres
    container_name: chap
    build: .
    environment:
      - GOOGLE_SERVICE_ACCOUNT_EMAIL=${GOOGLE_SERVICE_ACCOUNT_EMAIL}
      - GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY=${GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY}
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - CHAP_DATABASE_URL=postgresql://root:thisisnotgoingtobeexposed@postgres:5432/chap_core
      - CELERY_BROKER=redis://redis:6379/0
      - IS_IN_DOCKER=1
    ports:
      - "8000:8000"
    expose:
      - "8000"
    command: /app/.venv/bin/chap serve --auto-reload
    working_dir: /
    networks:
      - chap-network
    volumes:
      - ./logs:/app/logs
      - ./chap_core:/app/chap_core
